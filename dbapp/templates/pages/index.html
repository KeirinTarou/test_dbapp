{% extends 'base.html' %}
{% block title %}Sample Page{% endblock %}
{% block contents %}
<main class="page page--sql">
    <section class="section section--intro">
        <h1 class="heading heading--xl">お笑いSQL道場</h1>
        <p class="text text--lead">入力したクエリを実行し、結果セットを表示します。</p>
    </section>

    <section class="section section--tables">
        <h2 class="heading heading--lg">テーブル一覧</h2>
        <p class="text text--lead">各テーブルの構造を確認できます。</p>

        <div class="pill-list">
            {% for table_name in table_names %}
                <a 
                    href="{{ url_for('show_table_structure', table_name=table_name) }}" 
                    class="pill pill--{{ loop.index0 % 6 }}"
                    title="{{ table_name }}テーブルの構造を表示します。"
                >
                    {{ table_name }}
                </a>
            {% endfor %}
        </div>
    </section>

    <section class="section section--query">
        <h2 class="heading heading--lg">クエリを入力</h2>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="messages">
                    {% for category, msg in messages %}
                        <li class="{{ category }}">{{ msg }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        <form class="form form--query" method="post" action="{{ url_for('index') }}">
            <!-- CodeMirrorラッパーの高さを保持 -->
            <input 
                type="hidden" 
                name="sql_query_height"
                id="sql_query_height" 
            /> 
            <!-- CodeMirrorをdivでラップ -->
            <div 
                id="sql_query_wrapper" 
                class="cm-wrapper"
                data-sql-query-height="{{ sql_query_height | default('', true) }}"
                {% if sql_query_height %}style="height: {{ sql_query_height }}px;"{% endif %}
            >
                <textarea
                    name="sql_query" 
                    id="sql_query" 
                    class="textarea textarea--sql" 
                    placeholder="SELECT文を入力"
                >{{ sql_query | default('', true) }}</textarea>
            </div>
            <div class="form-actions">
                <button 
                    type="submit" 
                    class="btn btn--execute"
                    title="入力したクエリを実行します。"
                >クエリ実行</button>
                <a 
                    href="{{ url_for('index') }}" 
                    class="btn btn--clear" 
                    title="入力内容をクリアします。"
                >クリア</a>
            </div>
        </form>
    </section>

    <section class="section section--result">
        <h2 class="heading heading--lg">実行結果</h2>
        <div class="table-container">
            <table class="table table--result">
                <thead>
                    <tr>
                        {% for col in columns %}
                            <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                        <tr>
                            {% for cell in row %}
                                <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="{{ columns|length }}">データがありません</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</main>
{% endblock %}
